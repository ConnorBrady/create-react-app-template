(function(){function getVideoURL(){var videoURLList=[];var format=getYoutubeURLArray();if(format){for(var i=0;i<format.length;i++){videoURLList.push([format[i][2],format[i][1],format[i][3]]);}}return videoURLList;}function formatSorter(a,b){var first=formatDesc[a[0]]?formatDesc[a[0]][0]:100;var second=formatDesc[b[0]]?formatDesc[b[0]][0]:100;return first-second;}function makeSimpleFlvArray(formats){function addOneInGroup(resolution){for(var i=0;i<formats.length;++i){if(formats[i][2]==resolution){ret[ret.length]=formats[i];break;}}}var ret=new Array();if(formats==null)return ret;for(var i=0;i<formats.length;++i){formats[i][2]=formatDesc[formats[i][0]]?formatDesc[formats[i][0]][2]:"unknown";formats[i][3]=formatDesc[formats[i][0]]?formatDesc[formats[i][0]][3]:"unknown";}addOneInGroup("Original");addOneInGroup("1080p HD");addOneInGroup("720p HD");addOneInGroup("480p");addOneInGroup("360p");addOneInGroup("240p");return ret;}function getYoutubeURLArray(){var htmlSource=document.getElementsByTagName("html")[0].innerHTML;if(top!=self){return new Array();}var htmlFive=htmlSource.search("html5-player")!=-1;var formats=new Array();var encodedTitle="unknown";if(document.getElementById("eow-title"))encodedTitle=document.getElementById("eow-title").getAttribute("title");else if(document.getElementById("playnav-curvideo-title")){var titleDiv=document.getElementById("playnav-curvideo-title");if(titleDiv.firstChild!=null){encodedTitle=escape(titleDiv.firstElementChild.text);}}if(!htmlFive&&g_isYoutubeChannel==false){var el_flash=document.getElementById("movie_player");if(!el_flash)return;var formatMap=el_flash.getAttribute("flashvars");formatMap=formatMap.split("url_encoded_fmt_stream_map=")[1].split("&")[0];formatMap=unescape(formatMap);formatMap=formatMap.replace(/%3A/g,":");formatMap=formatMap.replace(/%2F/g,"/");formatMap+=",";formatMap=formatMap.split("url=");for(var i=1;i<formatMap.length;++i){var item=formatMap[i];var reg=/(itag=|itag%3D)\d{1,}/;var itag=item.match(reg);itag=unescape(itag[0]);var formatNum;formatNum=itag.substring(itag.lastIndexOf("=")+1,itag.length);if(formatNum.length<=0)formatNum=item.substring(item.lastIndexOf("=")+1,item.length-1);var formatURL=item.substring(0,item.lastIndexOf("&itag="));if(formatURL.length<=0)formatURL=item;formatURL=unescape(formatURL);formats.push([formatNum,formatURL]);}formats.sort(formatSorter);return makeSimpleFlvArray(formats);}else{var formatMap=htmlSource.split('"url_encoded_fmt_stream_map"')[1];formatMap=formatMap.split('"')[1];formatMap=unescape(formatMap);formatMap=formatMap.replace(/\\u0026/g,"&");formatMap+=",";formatMap=formatMap.split("url=");for(var i=1;i<formatMap.length;++i){var item=formatMap[i];var formatNum=item.substring(item.lastIndexOf("=")+1,item.length-1);var formatURL=item.substring(0,item.lastIndexOf("\u0026itag="));formatURL=unescape(formatURL);formats.push([formatNum,formatURL]);}formats.sort(formatSorter);return makeSimpleFlvArray(formats);}}function AddUrl(videoURL,bObject){chrome.extension.sendRequest({'action':'AddUrl','videoURL':videoURL,'bObject':bObject});}function checkVideo(){var videoURL=bvd_InfoExtractor.getVideoInfo(getVideoURL());if(!videoURL)return false;if(typeof(videoURL)=="object"&&videoURL.length){BSMyTubeGetModule.AddUrl(videoURL,true);}else{}return true;}var g_isYoutubeChannel=false;var formatDesc=new Array();var i=0;formatDesc[37]=[i++,"1920x1080","1080p HD","MP4"];formatDesc[45]=[i++,"1280x720","720p HD","WebM"];formatDesc[22]=[i++,"1280x720","720p HD","MP4"];formatDesc[35]=[i++,"854x480","480p","FLV"];formatDesc[44]=[i++,"854x480","480p","WebM"];formatDesc[18]=[i++,"640x360","360p","MP4"];formatDesc[34]=[i++,"640x360","360p","FLV"];formatDesc[43]=[i++,"640x360","360p","WebM"];formatDesc[6]=[i++,"480x270","270p","FLV"];formatDesc[5]=[i++,"320x240","240p","FLV"];formatDesc[36]=[i++,"320x240","240p","WebM"];formatDesc[38]=[i++,"4k Resolution","Original","mp4"];formatDesc[84]=[i++,"1280x720","720p HD","MP4"];formatDesc[82]=[i++,"640x360","360p","MP4"];Array.prototype.remove=function(dx){if(isNaN(dx)||dx>this.length){return false;}for(var i=0,n=0;i<this.length;++i){if(this[i]!=this[dx]){this[n++]=this[i];}}this.length-=1;};function handleLoadEvent(event){checkVideo();};function handleBeforeLoadEvent(event){var element=event.target;if(element.allowedToLoad)return;if(!(element instanceof HTMLObjectElement||element instanceof HTMLEmbedElement))return;if(element.getAttribute("classid"))return;checkVideo();}checkVideo();document.addEventListener("beforeload",handleBeforeLoadEvent,true);document.addEventListener("load",handleLoadEvent,true);})()
